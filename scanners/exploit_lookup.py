import subprocess

def check_metasploit(service_name):
    try:
        search_term = service_name.strip().lower()

        cmd = f'msfconsole -q -x "search name:{search_term}; exit"'

        result = subprocess.run(cmd, shell=True, capture_output=True, text=True)

        if result.returncode != 0:
            return [f"[ERROR] Metasploit search failed for '{search_term}'"]

        lines = result.stdout.splitlines()
        matches = [line.strip() for line in lines if line.strip().startswith("exploit/")]

        return matches[:5] if matches else ["[!] No matching exploits found."]
    
    except Exception as e:
        return [f"[ERROR] Exception while searching Metasploit: {e}"]
